<% layout("/layouts/boilerplate.ejs") %>

<style>
  .my-bookings-container {
    max-width: 1000px;
    margin: 40px auto;
    padding: 0 15px;
  }

  .page-header {
    margin-bottom: 40px;
  }

  .page-title {
    font-size: 32px;
    font-weight: 700;
    color: #222;
    margin: 0 0 10px 0;
  }

  .page-subtitle {
    color: #666;
    margin: 0;
  }

  .bookings-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
    gap: 25px;
  }

  .booking-card {
    background: white;
    border-radius: 16px;
    box-shadow: 0 5px 20px rgba(0, 0, 0, 0.1);
    overflow: hidden;
    transition: all 0.3s ease;
  }

  .booking-card:hover {
    transform: translateY(-4px);
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.15);
  }

  .card-image {
    width: 100%;
    height: 180px;
    overflow: hidden;
    background: #f0f0f0;
    position: relative;
  }

  .card-image img {
    width: 100%;
    height: 100%;
    object-fit: cover;
  }

  .status-badge {
    position: absolute;
    top: 12px;
    right: 12px;
    padding: 6px 14px;
    border-radius: 20px;
    font-weight: 600;
    font-size: 12px;
    text-transform: uppercase;
  }

  .status-confirmed {
    background: #2ecc71;
    color: white;
  }

  .status-cancelled {
    background: #e74c3c;
    color: white;
  }

  .status-completed {
    background: #3498db;
    color: white;
  }

  .card-content {
    padding: 20px;
  }

  .listing-title {
    font-size: 18px;
    font-weight: 600;
    color: #222;
    margin: 0 0 8px 0;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
  }

  .listing-location {
    color: #999;
    font-size: 14px;
    margin-bottom: 15px;
  }

  .booking-info {
    display: flex;
    flex-direction: column;
    gap: 10px;
    margin-bottom: 15px;
    padding-bottom: 15px;
    border-bottom: 1px solid #f0f0f0;
  }

  .info-row {
    display: flex;
    align-items: center;
    gap: 8px;
    font-size: 13px;
    color: #666;
  }

  .info-row strong {
    color: #222;
  }

  .price-section {
    margin-bottom: 15px;
  }

  .total-price {
    font-size: 20px;
    font-weight: 700;
    color: #667eea;
  }

  .card-actions {
    display: flex;
    gap: 10px;
  }

  .btn-small {
    flex: 1;
    padding: 10px;
    border: none;
    border-radius: 10px;
    font-weight: 600;
    font-size: 13px;
    cursor: pointer;
    transition: all 0.2s;
    text-decoration: none;
    text-align: center;
  }

  .btn-view {
    background: #667eea;
    color: white;
  }

  .btn-view:hover {
    background: #5569d8;
  }

  .btn-cancel {
    background: #f8d7da;
    color: #721c24;
  }

  .btn-cancel:hover {
    background: #f5c6cb;
  }

  .empty-state {
    text-align: center;
    padding: 60px 20px;
  }

  .empty-icon {
    font-size: 60px;
    color: #ddd;
    margin-bottom: 20px;
  }

  .empty-title {
    font-size: 22px;
    font-weight: 600;
    color: #666;
    margin-bottom: 10px;
  }

  .empty-text {
    color: #999;
    margin-bottom: 30px;
  }

  .btn-explore {
    display: inline-block;
    padding: 12px 30px;
    background: #ff385c;
    color: white;
    border-radius: 10px;
    text-decoration: none;
    font-weight: 600;
  }

  .btn-explore:hover {
    background: #ed0a3b;
  }

  @media (max-width: 768px) {
    .bookings-grid {
      grid-template-columns: 1fr;
    }

    .page-title {
      font-size: 24px;
    }
  }

  /* Dark mode */
  body.dark-mode .my-bookings-container {
    color: #fff;
  }

  body.dark-mode .page-title {
    color: #fff;
  }

  body.dark-mode .page-subtitle {
    color: #aaa;
  }

  body.dark-mode .booking-card {
    background: #1e1e1e;
  }

  body.dark-mode .listing-title {
    color: #fff;
  }

  body.dark-mode .listing-location {
    color: #888;
  }

  body.dark-mode .info-row {
    color: #999;
  }

  body.dark-mode .info-row strong {
    color: #e5e5e5;
  }

  body.dark-mode .booking-info {
    border-color: #333;
  }

  body.dark-mode .empty-title {
    color: #e5e5e5;
  }

  body.dark-mode .empty-text {
    color: #888;
  }
</style>

<div class="my-bookings-container">
  <div class="page-header">
    <h1 class="page-title"><i class="fa-solid fa-ticket"></i> My Bookings</h1>
    <p class="page-subtitle">View and manage all your reservations</p>
  </div>

  <% if (bookings.length === 0) { %>
  <div class="empty-state">
    <div class="empty-icon"><i class="fa-regular fa-calendar-xmark"></i></div>
    <h2 class="empty-title">No bookings yet</h2>
    <p class="empty-text">
      You haven't made any reservations. Start exploring amazing listings today!
    </p>
    <a href="/listings" class="btn-explore">
      <i class="fa-solid fa-compass"></i> Explore Listings
    </a>
  </div>
  <% } else { %>
  <div class="bookings-grid">
    <% bookings.forEach(booking => { %>
    <div class="booking-card">
      <!-- Image -->
      <div class="card-image">
        <img
          src="<%= booking.listing.image.url %>"
          alt="<%= booking.listing.title %>"
        />
        <div class="status-badge status-<%= booking.status %>">
          <%= booking.status %>
        </div>
      </div>

      <!-- Content -->
      <div class="card-content">
        <h3 class="listing-title"><%= booking.listing.title %></h3>
        <p class="listing-location">
          <i class="fa-solid fa-map-pin"></i> <%= booking.listing.location %>
        </p>

        <!-- Booking Info -->
        <div class="booking-info">
          <div class="info-row">
            <i class="fa-solid fa-calendar"></i>
            <span
              ><strong
                ><%= booking.checkInDate.toLocaleDateString("en-IN", { month:
                "short", day: "numeric" }) %></strong
              >
              -
              <strong
                ><%= booking.checkOutDate.toLocaleDateString("en-IN", { month:
                "short", day: "numeric" }) %></strong
              ></span
            >
          </div>
          <div class="info-row">
            <i class="fa-solid fa-people-group"></i>
            <span
              ><strong><%= booking.numberOfGuests %></strong> <%=
              booking.numberOfGuests > 1 ? "guests" : "guest" %></span
            >
          </div>
          <div class="info-row">
            <i class="fa-solid fa-moon"></i>
            <span
              ><strong><%= booking.numberOfNights %></strong> <%=
              booking.numberOfNights > 1 ? "nights" : "night" %></span
            >
          </div>
        </div>

        <!-- Price -->
        <div class="price-section">
          <div class="total-price">
            â‚¹<%= booking.totalPrice.toLocaleString("en-IN") %>
          </div>
        </div>

        <!-- Actions -->
        <div class="card-actions">
          <a
            href="/bookings/<%= booking._id %>/confirmation"
            class="btn-small btn-view"
          >
            <i class="fa-solid fa-eye"></i> View Details
          </a>
          <% const now = new Date(); const checkIn = new
          Date(booking.checkInDate); %> <% if (booking.status === "confirmed" &&
          now < checkIn) { %>

          <form
            method="POST"
            action="/bookings/<%= booking._id %>/cancel"
            style="flex: 1"
          >
            <button
              type="submit"
              class="btn-small btn-cancel"
              onclick="return confirm('Are you sure you want to cancel this booking?')"
            >
              <i class="fa-solid fa-times"></i> Cancel
            </button>
          </form>
          <% } %>
        </div>
      </div>
    </div>
    <% }); %>
  </div>
  <% } %>
</div>
